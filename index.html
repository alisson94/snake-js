<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>SnakeJS</title>
    <meta name='viewport' content='width=device-width, user-scalable=no'>
    <link rel="stylesheet" href="style.css">

</head>
<body onload="init()">
    <div class="container">
        <div class="header">
            <p id="score">0</p>
            <p id="hscore">0</p>
        </div>
        <canvas id="c" width="510px" height="345px"></canvas>
        <div class="gameOver">
            <h1>Game Over</h1><br>
            <button onclick="reiniciar()">Reiniciar</button>
        </div>
    </div>

    <script>
        var c = document.getElementById('c')
        var ctx = c.getContext('2d')
        var intervalo = setInterval(loop, 60)
        addEventListener('keydown', apertou)
        
        var comidaX
        var comidaY

        var s
        var tamanho
        var direcao

        function init() {
            comidaX = Math.floor(Math.random() * 34) * 15
            comidaY = Math.floor(Math.random() * 23) * 15

            s = []
            tamanho = 15
            direcao = 'direita'
            for(var i=0; i < 3; i++){
                s[i] = {
                    x : 105 - i * tamanho,
                    y : 105,
                    direcao: 'direita'
                }
            }
        }
    
        function apertou(e) {
            switch (e.keyCode) {
                case 38:  //87
                    if(s[0].direcao != 'baixo'){
                        s[0].direcao = 'cima'
                    }
                    break
                case 40:  //83
                    if(s[0].direcao != 'cima'){
                        s[0].direcao = 'baixo'
                    }
                    break
                case 39:  //68
                    if(s[0].direcao != 'esquerda'){
                        s[0].direcao = 'direita'
                    }
                    break
                case 37:  //65
                    if(s[0].direcao != 'direita'){
                        s[0].direcao = 'esquerda'
                    }
                    break  
                case 80:
                    clearInterval(intervalo)
            }
        }

        function loop(){
            ctx.clearRect(0, 0, c.width, c.height)
            
            comeu()
            mover()
            seMordeu()

            ctx.fillStyle = 'red'
            ctx.fillRect(comidaX, comidaY, tamanho, tamanho);

            ctx.fillStyle = 'black'
            for(var i in s){
                ctx.fillRect(s[i].x, s[i].y, tamanho, tamanho)
            }

            ctx.font = '15pt Arial'
            ctx.fillText(comidaX, 10, c.height - 25)

            ctx.font = '15pt Arial'
            ctx.fillText(comidaY, 10, c.height - 5)
        }

        function mover(){
            for(var i = s.length-1; i >= 0; i--){
                if(i != 0){
                    s[i].x = s[i-1].x
                    s[i].y = s[i-1].y
                }else{
                    switch (s[i].direcao) {
                        case 'cima':
                            if(s[i].y > 0){
                                s[i].y -= tamanho
                            }else{
                                gameOver()
                            }
                            break
                        case 'baixo':
                            if(s[i].y + tamanho < c.height){
                                s[i].y += tamanho
                            }else{
                                gameOver()
                            }
                            break
                        case 'direita':
                            if(s[i].x + tamanho < c.width){
                                s[i].x += tamanho
                            }else{
                                gameOver()
                            }
                            
                            break
                        case 'esquerda':
                            if(s[i].x > 0){
                                s[i].x -= tamanho
                            }else{
                                gameOver()
                            }
                            break  
                    } 
                }
            }
        }

        function comeu() {
            if(s[0].x == comidaX && s[0].y == comidaY){
                comidaX = Math.floor(Math.random() * 33) * 15
                comidaY = Math.floor(Math.random() * 22) * 15
                aumentarPontuacao();

                var ultimo = s[s.length-1]
                
                s.push({
                    x : ultimo.x,
                    y : ultimo.y
                    
                })
            }
        }

        function seMordeu(){
            for (let i = 1; i < s.length; i++) {
                if(s[0].x == s[i].x && s[0].y == s[i].y){
                    gameOver()
                }
                
            }
        }

        function aumentarPontuacao() {
            var p = document.querySelector('p#score')
            var mp = document.querySelector('p#hscore')
            p.innerText = parseInt(p.innerText) + 10
            if(parseInt(p.innerText) > parseInt(mp.innerText)){
                mp.innerText = p.innerText
            }

        }

        function gameOver() {
            
            tamanho = 0
            document.querySelector('div.gameOver').style.opacity = 1
        }
        function reiniciar() {
            init()
            document.querySelector('p#score').innerText = 0
            document.querySelector('div.gameOver').style.opacity = 0
        }
        
    </script>
</body>
</html>